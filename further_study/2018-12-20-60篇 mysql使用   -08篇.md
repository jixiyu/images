> study  
> 2018年12月20日11:23:44       
> 60  
>made by jixi  

## Mysql数据库学习


----------


### 1. install

mac install (前提已经安装好了homebrew)  



``` xml
1. brew search mysql  

2. brew install mysql  

3. mysql.server start  
```

----------

### 2. 启动及查看状态、登录(记住有分号)  
启动 MySQL：  

``` xml
1. systemctl start mysqld  
```

查看 MySQL 运行状态：  

``` xml
2. systemctl status mysqld  
```

在成功安装 MySQL 后，一些基础表会表初始化，在服务器启动后，你可以通过简单的测试来验证 MySQL 是否工作正常。  
使用 mysqladmin 工具来获取服务器状态：  
使用 mysqladmin 命令俩检查服务器的版本, 在 linux 上该二进制文件位于 /usr/bin 目录，在 Windows 上该二进制文件位于C:\mysql\bin 。  

``` xml
3. mysqladmin --version  
```

陈列所有的数据库  

``` xml
4. SHOW DATABASES;  
```

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545277637735.png)  

登录mysql  

``` xml
5. mysql -uroot   

6. mysql -u root -p  
```

当 MySQL 服务已经运行时, 我们可以通过 MySQL 自带的客户端工具登录到 MySQL 数据库中, 首先打开命令提示符, 输入以下格式的命名:  

参数说明：  

-h : 指定客户端所要登录的 MySQL 主机名, 登录本机(localhost 或 127.0.0。1)该参数可以省略;  
-u : 登录的用户名;  
-p : 告诉服务器将会使用一个密码来登录, 如果所要登录的用户名密码为空, 可以忽略此选项。  


``` xml
7. mysql -h 主机名 -u 用户名 -p  
```

----------


### 3. 用户设置  

1.  
如果你需要添加 MySQL 用户，你只需要在 mysql 数据库中的 user 表添加新用户即可。  

以下为添加用户的的实例，用户名为guest，密码为guest123，并授权用户可进行 SELECT, INSERT 和 UPDATE操作权限：  



``` nginx
root@host# mysql -u root -p  
Enter password:*******  
mysql> use mysql;  
Database changed  
```

``` 
mysql> INSERT INTO user    
          (host, user, password,  
           select_priv, insert_priv, update_priv)  
           VALUES ('localhost', 'guest',  
           PASSWORD('guest123'), 'Y', 'Y', 'Y');
           
           Query OK, 1 row affected (0.20 sec)  

mysql> FLUSH PRIVILEGES;  
Query OK, 1 row affected (0.01 sec)  

mysql> SELECT host, user, password FROM user WHERE user = 'guest';  
+-----------+---------+------------------+  
| host      | user    | password         |  
+-----------+---------+------------------+  
| localhost | guest | 6f8c114b58f2ce9e |  
+-----------+---------+------------------+  
1 row in set (0.00 sec)  
```  


2.  

另外一种添加用户的方法为通过SQL的 GRANT 命令，以下命令会给指定数据库TUTORIALS添加用户 zara ，密码为 zara123 。  

``` n1ql
root@host# mysql -u root -p  
Enter password:*******  
mysql> use mysql;  
Database changed  

mysql> GRANT SELECT,INSERT,UPDATE,DELETE,CREATE,DROP  
    -> ON TUTORIALS.*  
    -> TO 'zara'@'localhost'  
    -> IDENTIFIED BY 'zara123';  
```

以上命令会在mysql数据库中的user表创建一条用户信息记录。  

3.  
查看 MySQL 用户权限  

``` sql
show grants;
```

4.  
查看其他 MySQL 用户权限：  

``` sql
show grants for dba@localhost;
```

----------

### 4. 管理数据库命令  

1.  

USE 数据库名 :  
选择要操作的Mysql数据库，使用该命令后所有Mysql命令都只针对该数据库。  

``` php
mysql> use RUNOOB;  
Database changed  
```

2.  
SHOW TABLES:  
显示指定数据库的所有表，使用该命令前需要使用 use 命令来选择要操作的数据库。  

``` asciidoc
mysql> use RUNOOB;  
Database changed  
mysql> SHOW TABLES;  
+------------------+  
| Tables_in_runoob |  
+------------------+  
| employee_tbl     |  
| runoob_tbl       |  
| tcount_tbl       |  
+------------------+  
3 rows in set (0.00 sec)  
```

3.  

SHOW COLUMNS FROM 数据表:
显示数据表的属性，属性类型，主键信息 ，是否为 NULL，默认值等其他信息。

``` gherkin
mysql> SHOW COLUMNS FROM runoob_tbl;  
+-----------------+--------------+------+-----+---------+-------+  
| Field           | Type         | Null | Key | Default | Extra |  
+-----------------+--------------+------+-----+---------+-------+  
| runoob_id       | int(11)      | NO   | PRI | NULL    |       |  
| runoob_title    | varchar(255) | YES  |     | NULL    |       |  
| runoob_author   | varchar(255) | YES  |     | NULL    |       |  
| submission_date | date         | YES  |     | NULL    |       |  
+-----------------+--------------+------+-----+---------+-------+  
4 rows in set (0.01 sec)  
```

4. 
SHOW INDEX FROM 数据表:  
显示数据表的详细索引信息，包括PRIMARY KEY（主键）。  

``` jboss-cli
mysql> SHOW INDEX FROM runoob_tbl;  
+------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+  
| Table      | Non_unique | Key_name | Seq_in_index | Column_name | Collation | Cardinality | Sub_part | Packed | Null | Index_type | Comment | Index_comment |  
+------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+  
| runoob_tbl |          0 | PRIMARY  |            1 | runoob_id   | A         |           2 |     NULL | NULL   |      | BTREE      |         |               |  
+------------+------------+----------+--------------+-------------+-----------+-------------+----------+--------+------+------------+---------+---------------+  
1 row in set (0.00 sec)  
```

5.  
SHOW TABLE STATUS LIKE [FROM db_name] [LIKE 'pattern'] \G:   
该命令将输出Mysql数据库管理系统的性能及统计信息。  

``` gams
mysql> SHOW TABLE STATUS  FROM RUNOOB;   # 显示数据库 RUNOOB 中所有表的信息  

mysql> SHOW TABLE STATUS from RUNOOB LIKE 'runoob%';     # 表名以runoob开头的表的信息  
mysql> SHOW TABLE STATUS from RUNOOB LIKE 'runoob%'\G;   # 加上 \G，查询结果按列打印  
```

----------

### 5. 创建数据库

1.  
我们可以在登陆 MySQL 服务后，使用 create 命令创建数据库，语法如下:  

``` sql
CREATE DATABASE 数据库名;  
```

2.  
使用 mysqladmin 创建数据库  
使用普通用户，你可能需要特定的权限来创建或者删除 MySQL 数据库。  

所以我们这边使用root用户登录，root用户拥有最高权限，可以使用 mysql mysqladmin 命令来创建数据库。  

以下命令简单的演示了创建数据库的过程，数据名为 RUNOOB:  

``` elixir
[root@host]# mysqladmin -u root -p create RUNOOB  
Enter password:******  
```

以上命令执行成功后会创建 MySQL 数据库 RUNOOB。  

3.  
drop 命令删除数据库  

``` sql
drop 命令格式：

drop database <数据库名>;
```

4.  
使用 mysqladmin 删除数据库  
你也可以使用 mysql mysqladmin 命令在终端来执行删除命令。  

以下实例删除数据库 RUNOOB(该数据库在前一章节已创建)：  

``` elixir
[root@host]# mysqladmin -u root -p drop RUNOOB  
Enter password:******  
```

执行以上删除数据库命令后，会出现一个提示框，来确认是否真的删除数据库：  

``` sql
Dropping the database is potentially a very bad thing to do.  
Any data stored in the database will be destroyed.  

Do you really want to drop the 'RUNOOB' database [y/N] y  
Database "RUNOOB" dropped  
```

----------

### 6. 数据类型  
MySQL支持多种类型，大致可以分为三类：数值、日期/时间和字符串(字符)类型。  

1.  
数值类型  

MySQL支持所有标准SQL数值数据类型。  

这些类型包括严格数值数据类型(INTEGER、SMALLINT、DECIMAL和NUMERIC)，以及近似数值数据类型(FLOAT、REAL和DOUBLE PRECISION)。  

关键字INT是INTEGER的同义词，关键字DEC是DECIMAL的同义词。  

BIT数据类型保存位字段值，并且支持MyISAM、MEMORY、InnoDB和BDB表。  

作为SQL标准的扩展，MySQL也支持整数类型TINYINT、MEDIUMINT和BIGINT。下面的表显示了需要的每个整数类型的存储和范围。  

``` lsl
TINYINT	————1 字节		小整数值  
SMALLINT	2 字节		大整数值  
MEDIUMINT	3 字节		大整数值  
INT或INTEGER	4 字节		大整数值  
BIGINT	————8 字节		极大整数值  
FLOAT	————4 字节		单精度、浮点数值  
DOUBLE	————8 字节		双精度、浮点数值  
DECIMAL	对DECIMAL(M,D) ，如果M>D，为M+2否则为D+2	依赖于M和D的值	依赖于M和D的值	小数值  

```

2.  
日期和时间类型  
表示时间值的日期和时间类型为DATETIME、DATE、TIMESTAMP、TIME和YEAR。  

每个时间类型有一个有效值范围和一个"零"值，当指定不合法的MySQL不能表示的值时使用"零"值。  

TIMESTAMP类型有专有的自动更新特性，将在后面描述。  

``` subunit
DATE	3	1000-01-01/9999-12-31	YYYY-MM-DD	日期值  
TIME	3	'-838:59:59'/'838:59:59'	HH:MM:SS	时间值或持续时间  
YEAR	1	1901/2155	YYYY	年份值  
DATETIME	8	1000-01-01 00:00:00/9999-12-31 23:59:59	YYYY-MM-DD HH:MM:SS	混合日期和时间值  
TIMESTAMP	4	
1970-01-01 00:00:00/2038————YYYYMMDD HHMMSS	混合日期和时间值，时间戳  
```

3.  
字符串类型  
字符串类型指CHAR、VARCHAR、BINARY、VARBINARY、BLOB、TEXT、ENUM和SET。该节描述了这些类型如何工作以及如何在查询中使用这些类型。  

``` lsl
CHAR	0-255字节	定长字符串  
VARCHAR	0-65535 字节	变长字符串  
TINYBLOB	0-255字节	不超过 255 个字符的二进制字符串  
TINYTEXT	0-255字节	短文本字符串  
BLOB	0-65 535字节	二进制形式的长文本数据  
TEXT	0-65 535字节	长文本数据  
MEDIUMBLOB	0-16 777 215字节	二进制形式的中等长度文本数据  
MEDIUMTEXT	0-16 777 215字节	中等长度文本数据  
LONGBLOB	0-4 294 967 295字节	二进制形式的极大文本数据  
LONGTEXT	0-4 294 967 295字节	极大文本数据  
```

4.  

MySQL 5.0 以上的版本：  

1、一个汉字占多少长度与编码有关：  

UTF－8：一个汉字＝3个字节  

GBK：一个汉字＝2个字节  

2、varchar(n) 表示 n 个字符，无论汉字和英文，Mysql 都能存入 n 个字符，仅是实际字节长度有所区别  

3、MySQL 检查长度，可用 SQL 语言来查看：  

``` sql
select LENGTH(fieldname) from tablename  
```

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545292094912.png)

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545292108837.png)

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545292115902.png)

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545292124767.png)

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545292138185.png)

----------

### 7. 创建数据表

1.  
创建MySQL数据表需要以下信息：  

表名  
表字段名  
定义每个表字段  

``` gams
CREATE TABLE table_name (column_name column_type);  
```
以下例子中我们将在 RUNOOB 数据库中创建数据表runoob_tbl：  

``` sql
CREATE TABLE IF NOT EXISTS `runoob_tbl`(  
   `runoob_id` INT UNSIGNED AUTO_INCREMENT,  
   `runoob_title` VARCHAR(100) NOT NULL,  
   `runoob_author` VARCHAR(40) NOT NULL,  
   `submission_date` DATE,  
   PRIMARY KEY ( `runoob_id` )  
)ENGINE=InnoDB DEFAULT CHARSET=utf8;  
```

实例解析：  

如果你不想字段为 NULL 可以设置字段的属性为 NOT NULL， 在操作数据库时如果输入该字段的数据为NULL ，就会报错。  
AUTO_INCREMENT定义列为自增的属性，一般用于主键，数值会自动加1。  
PRIMARY KEY关键字用于定义列为主键。 您可以使用多列来定义主键，列间以逗号分隔。  
ENGINE 设置存储引擎，CHARSET 设置编码。  


2.  
删除数据表  

以下为删除MySQL数据表的通用语法：  

``` gams
DROP TABLE table_name ;  
```

实例  
以下实例删除了数据表runoob_tbl:  

``` shell
root@host# mysql -u root -p  
Enter password:*******  
mysql> use RUNOOB;  
Database changed  
mysql> DROP TABLE runoob_tbl  
Query OK, 0 rows affected (0.8 sec)  
mysql>  
```


3.  
插入数据  

以下为向MySQL数据表插入数据通用的 INSERT INTO SQL语法：  

``` lisp
INSERT INTO table_name ( field1, field2,...fieldN )  
                       VALUES  
                       ( value1, value2,...valueN );  
```

如果数据是字符型，必须使用单引号或者双引号，如："value"。  


实例  
以下实例中我们将向 runoob_tbl 表插入三条数据:  

``` haml
root@host# mysql -u root -p password;  
Enter password:*******  
mysql> use RUNOOB;  
Database changed  
mysql> INSERT INTO runoob_tbl   
    -> (runoob_title, runoob_author, submission_date)  
    -> VALUES  
    -> ("学习 PHP", "菜鸟教程", NOW());  
Query OK, 1 rows affected, 1 warnings (0.01 sec)  
mysql> INSERT INTO runoob_tbl  
    -> (runoob_title, runoob_author, submission_date)  
    -> VALUES  
    -> ("学习 MySQL", "菜鸟教程", NOW());  
Query OK, 1 rows affected, 1 warnings (0.01 sec)  
mysql> INSERT INTO runoob_tbl  
    -> (runoob_title, runoob_author, submission_date)  
    -> VALUES  
    -> ("JAVA 教程", "RUNOOB.COM", '2016-05-06');  
Query OK, 1 rows affected (0.00 sec)  
mysql>  
```


----------

### 8. 查询数据

1.  
以下为在MySQL数据库中查询数据通用的 SELECT 语法：  

``` markdown
SELECT column_name,column_name  
FROM table_name  
[WHERE Clause]  
[LIMIT N][ OFFSET M]  
```

查询语句中你可以使用一个或者多个表，表之间使用逗号(,)分割，并使用WHERE语句来设定查询条件。  
SELECT 命令可以读取一条或者多条记录。  
你可以使用星号（*）来代替其他字段，SELECT语句会返回表的所有字段数据  
你可以使用 WHERE 语句来包含任何条件。  
你可以使用 LIMIT 属性来设定返回的记录数。  
你可以通过OFFSET指定SELECT语句开始查询的数据偏移量。默认情况下偏移量为0。  

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545297069301.png)  


----------

### 9. MySQL WHERE 子句

1.  
我们知道从 MySQL 表中使用 SQL SELECT 语句来读取数据。  

如需有条件地从表中选取数据，可将 WHERE 子句添加到 SELECT 语句中。  

以下是 SQL SELECT 语句使用 WHERE 子句从数据表中读取数据的通用语法：  

``` lasso
SELECT field1, field2,...fieldN FROM table_name1, table_name2...  
[WHERE condition1 [AND [OR]] condition2.....  
```

查询语句中你可以使用一个或者多个表，表之间使用逗号, 分割，并使用WHERE语句来设定查询条件。  
你可以在 WHERE 子句中指定任何条件。    
你可以使用 AND 或者 OR 指定一个或多个条件。  
WHERE 子句也可以运用于 SQL 的 DELETE 或者 UPDATE 命令。  
WHERE 子句类似于程序语言中的 if 条件，根据 MySQL 表中的字段值来读取指定的数据。  


2.  
以下为操作符列表，可用于 WHERE 子句中。  

下表中实例假定 A 为 10, B 为 20  
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545297449264.png)  

如果我们想在 MySQL 数据表中读取指定的数据，WHERE 子句是非常有用的。  

使用主键来作为 WHERE 子句的条件查询是非常快速的。  

如果给定的条件在表中没有任何匹配的记录，那么查询不会返回任何数据。  

3.  
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545297626936.png)  

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545297660383.png)  



----------

### 10. MySQL UPDATE 查询  

如果我们需要修改或更新 MySQL 中的数据，我们可以使用 SQL UPDATE 命令来操作。.  
update 语句可用来修改表中的数据, 简单来说基本的使用形式为:  

``` sql
update 表名称 set 列名称=新值 where 更新条件;  
```

1.  
以下是 UPDATE 命令修改 MySQL 数据表数据的通用 SQL 语法：  

``` sql
UPDATE table_name SET field1=new-value1, field2=new-value2  
[WHERE Clause]  
```

你可以同时更新一个或多个字段。  
你可以在 WHERE 子句中指定任何条件。  
你可以在一个单独表中同时更新数据。  
当你需要更新数据表中指定行的数据时 WHERE 子句是非常有用的。  

通过命令提示符更新数据  
以下我们将在 SQL UPDATE 命令使用 WHERE 子句来更新 runoob_tbl 表中指定的数据：  

2.  
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545297917867.png)  


----------

### 11. MySQL DELETE 语句  
你可以使用 SQL 的 DELETE FROM 命令来删除 MySQL 数据表中的记录。  

你可以在 mysql> 命令提示符或 PHP 脚本中执行该命令。  

1.  
以下是 SQL DELETE 语句从 MySQL 数据表中删除数据的通用语法：  

``` sql
DELETE FROM table_name [WHERE Clause]
```

如果没有指定 WHERE 子句，MySQL 表中的所有记录将被删除。  
你可以在 WHERE 子句中指定任何条件  
您可以在单个表中一次性删除记录。  
当你想删除数据表中指定的记录时 WHERE 子句是非常有用的。  

2.  
实例  

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545298183883.png)  


----------

### 12. MySQL LIKE 子句  

我们知道在 MySQL 中使用 SQL SELECT 命令来读取数据， 同时我们可以在 SELECT 语句中使用 WHERE 子句来获取指定的记录。  

WHERE 子句中可以使用等号 = 来设定获取数据的条件，如 "runoob_author = 'RUNOOB.COM'"。  

但是有时候我们需要获取 runoob_author 字段含有 "COM" 字符的所有记录，这时我们就需要在 WHERE 子句中使用 SQL LIKE 子句。  

SQL LIKE 子句中使用百分号 %字符来表示任意字符，类似于UNIX或正则表达式中的星号 *。  

如果没有使用百分号 %, LIKE 子句与等号 = 的效果是一样的。  

1.  
语法  

以下是 SQL SELECT 语句使用 LIKE 子句从数据表中读取数据的通用语法：  

``` sql
SELECT field1, field2,...fieldN   
FROM table_name  
WHERE field1 LIKE condition1 [AND [OR]] filed2 = 'somevalue'  
```

你可以在 WHERE 子句中指定任何条件。  
你可以在 WHERE 子句中使用LIKE子句。  
你可以使用LIKE子句代替等号 =。  
LIKE 通常与 % 一同使用，类似于一个元字符的搜索。  
你可以使用 AND 或者 OR 指定一个或多个条件。  
你可以在 DELETE 或 UPDATE 命令中使用 WHERE...LIKE 子句来指定条件。  


2.  
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545298578915.png)  


----------
### 13. UNION 操作符  

MySQL UNION 操作符用于连接两个以上的 SELECT 语句的结果组合到一个结果集合中。多个 SELECT 语句会删除重复的数据。  

1.  
MySQL UNION 操作符语法格式：  

``` sql
SELECT expression1, expression2, ... expression_n
FROM tables
[WHERE conditions]
UNION [ALL | DISTINCT]
SELECT expression1, expression2, ... expression_n
FROM tables
[WHERE conditions];
```
参数  

expression1, expression2, ... expression_n: 要检索的列。  

tables: 要检索的数据表。  

WHERE conditions: 可选， 检索条件。  

DISTINCT: 可选，删除结果集中重复的数据。默认情况下 UNION 操作符已经删除了重复数据，所以 DISTINCT 修饰符对结果没啥影响。  

ALL: 可选，返回所有结果集，包含重复数据。  

2.  
演示数据库  
在本教程中，我们将使用 RUNOOB 样本数据库。  

下面是选自 "Websites" 表的数据：  

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369092565.png)  

下面是 "apps" APP 的数据：  
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369114426.png)  

3.  
实例  
下面的 SQL 语句从 "Websites" 和 "apps" 表中选取所有不同的country（只有不同的值）：  

实例  

``` sql
SELECT country FROM Websites
UNION
SELECT country FROM apps
ORDER BY country;
```
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369214818.png)  

注释：UNION 不能用于列出两个表中所有的country。如果一些网站和APP来自同一个国家，每个国家只会列出一次。UNION 只会选取不同的值。请使用 UNION ALL 来选取重复的值！  

4.  
SQL UNION ALL 实例  
下面的 SQL 语句使用 UNION ALL 从 "Websites" 和 "apps" 表中选取所有的country（也有重复的值）：  

实例  

``` n1ql
SELECT country FROM Websites
UNION ALL
SELECT country FROM apps
ORDER BY country;
```
![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369319926.png)  

5.  
带有 WHERE 的 SQL UNION ALL  
下面的 SQL 语句使用 UNION ALL 从 "Websites" 和 "apps" 表中选取所有的中国(CN)的数据（也有重复的值）：  

实例  

``` sql
SELECT country, name FROM Websites
WHERE country='CN'
UNION ALL
SELECT country, app_name FROM apps
WHERE country='CN'
ORDER BY country;
```

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369355037.png)  


----------
### 14.  排序  
我们知道从 MySQL 表中使用 SQL SELECT 语句来读取数据。  

如果我们需要对读取的数据进行排序，我们就可以使用 MySQL 的 ORDER BY 子句来设定你想按哪个字段哪种方式来进行排序，再返回搜索结果。  

1.  
语法  
以下是 SQL SELECT 语句使用 ORDER BY 子句将查询数据排序后再返回数据：  

``` lasso
SELECT field1, field2,...fieldN table_name1, table_name2...
ORDER BY field1, [field2...] [ASC [DESC]]
```

你可以使用任何字段来作为排序的条件，从而返回排序后的查询结果。  
你可以设定多个字段来排序。  
你可以使用 ASC 或 DESC 关键字来设置查询结果是按升序或降序排列。 默认情况下，它是按升序排列。  
你可以添加 WHERE...LIKE 子句来设置条件。  

2.  
在命令提示符中使用 ORDER BY 子句  

以下将在 SQL SELECT 语句中使用 ORDER BY 子句来读取MySQL 数据表 runoob_tbl 中的数据：  

实例  
尝试以下实例，结果将按升序及降序排列。  

![enter description here](https://www.github.com/jixiyu/images3/raw/master/小书匠/1545369975539.png)  
读取 runoob_tbl 表中所有数据并按 submission_date 字段的升序排列。  
3.  



----------


## END

