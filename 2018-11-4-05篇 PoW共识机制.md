> 链-共识机制    
> 2018年11月4日20:41:35     
> 05 篇  

### Consensus——PoW


----------


## 1. Proof  of Work 工作量证明  
比特币网络是完全公开的，任何人都可以匿名接入，因此共识协议的稳定性和防攻击性十分关键。

比特币区块链采用了 Proof of Work（PoW）的机制来实现共识，该机制最早于 1998 年在 B-money 设计中提出。

目前，Proof of X 系列中比较出名的一致性协议包括 PoW、PoS 和 DPoS 等，都是通过经济惩罚来限制恶意参与。


----------
## 2.工作量证明  
工作量证明，通过计算来猜测一个数值（nonce），使得拼凑上交易数据后内容的 Hash 值满足规定的上限（来源于 hashcash）。由于 Hash 难题在目前计算模型下需要大量的计算，这就保证在一段时间内，系统中只能出现少数合法提案。反过来，能够提出合法提案，也证明提案者确实已经付出了一定的工作量。  

同时，这些少量的合法提案会在网络中进行广播，收到的用户进行验证后，会基于用户认为的最长链基础上继续难题的计算。因此，系统中可能出现链的分叉（Fork），但最终会有一条链成为最长的链。  

Hash 问题具有不可逆的特点，因此，目前除了暴力计算外，还没有有效的算法进行解决。反之，如果获得符合要求的 nonce，则说明在概率上是付出了对应的算力。谁的算力多，谁最先解决问题的概率就越大。当掌握超过全网一半算力时，从概率上就能控制网络中链的走向。这也是所谓 51% 攻击的由来。  

参与 PoW 计算比赛的人，将付出不小的经济成本（硬件、电力、维护等）。当没有最终成为首个算出合法 nonce 值的“幸运儿”时，这些成本都将被沉没掉。这也保障了，如果有人尝试恶意破坏，需要付出大量的经济成本。也有设计试图将后算出结果者的算力按照一定比例折合进下一轮比赛考虑。
  
    
***有一个很直观的超市付款的例子，可以说明为何这种经济博弈模式会确保系统中最长链的唯一性。***


<img src="https://www.github.com/jixiyu/images3/raw/master/小书匠/1541335643675.png" width="200" height="300" />   
  
    

假定超市只有一个出口，付款时需要排成一队，可能有人不守规矩要插队。超市管理员会检查队伍，认为最长的一条队伍是合法的，并让不合法的分叉队伍重新排队。新到来的人只要足够理智，就会自觉选择最长的队伍进行排队。这是因为，看到多条链的参与者往往认为目前越长的链具备越大的胜出可能性，从而更倾向于选择长的链。

比特币采用的 POW 工作量证明共识机制，在生成区块时，系统让所有节点 公平地去计算一个随机数，最先寻找到随机数的节点即是这个区块的生产者，并 获得相应的区块奖励。由于哈希函数是散列函数，求解随机数的唯一方法在数学 上只能是穷举，随机性非常好，每个人都可以参与协议的执行。由于梅克尔树根的设置，哈希函数的解的验证过程也能迅速实现。因此，比特币的 POW 共识机 制门槛很低，无需中心化权威的许可，人人都可以参与，并且每一个参与者都无 需身份认证。  

同时，中本聪通过工作量证明的机制破解了无门槛分布式系统的“女巫攻击” 问题。对系统发起攻击需要掌握超过 50%的算力，系统的安全保障较强。   

POW 共识的优点可归纳为:      

- ◼  算法简单，容易实现，节点可自由进入，去中心化程度高。     

- ◼  破坏系统需要投入极大的成本，安全性极高。        

- ◼ 区块生产者的选择通过节点求解哈希函数实现，提案的产生、验证到共识的最终达成过程是一个纯数学问题，节点间无需交换额外的信息即可达成共识，整个过程不需要人性的参与。  

比特币系统的设定在保证安全性的的前提下，牺牲了一部分最终性。因此，POW 共识算法也存在一些问题:    

- ◼  为了保证去中心化程度，区块的确认时间难以缩短。  

- ◼  没有最终性，需要检查点机制来弥补最终性，但随着确认次数的增加，达成共识的可能性也呈指数级地增长。 由于这两个方面的问题，一笔交易为了确保安全，要在 6 个新的区块产生后才能在全网得到确认，也就是说一个交易的确认延迟时间大概为 1 小时，这无法 满足现实世界中对交易实时性要求很高的应用场景。 

   另一方面，POW 共识算法带来了硬件设备的大量浪费。随着比特币价值的 增长，比特币算力竞赛经历了从 CPU 到 GPU，再到 ASIC 专用芯片的阶段。算力强大的 ASIC 芯片矿机将挖矿算法硬件化，而 ASIC 芯片矿机在淘汰后，没有 其他的用途，造成了大量的硬件浪费。


----------
## 3.POW 共识机制能源消耗的必要性  

正如张首晟教授所言，现实世界的熵总是在增加的。POW 共识机制将虚拟 世界和现实世界连接起来，分布式系统中达成共识的过程是一个熵减的过程，这 需要现实世界的熵增来平衡，能量消耗即是提供熵增的平衡方式。

相比于 POW 共识把系统的安全性交给了数学和能量消耗，POS 共识把系 统的安全性交给了人性的博弈。POS 共识是虚拟世界中的一个封闭系统，如果 共识的达成没有付出任何代价，共识的可靠性就可能存疑，人性博弈过程中的混 乱一定会暴露出来。

POS 的升级模式 DPOS 共识机制的共识过程类似于精英代议制，是一种常 设特权的治理架构，容易产生腐化。卢梭对代议制的描述是:“民意一旦被代表， 终究会被扭曲”。DPOS 共识机制是为了效率而生的，它更加适用于对性能要求 极高的相对封闭的商业系统。

而对于 BFT 共识机制，由于节点扩展性的缺陷，其共识节点的选择过程一 样是封闭或者需要验证的，因而也更加适用于相对封闭的应用环境。

信任的产生是需要付出代价的，POW 共识机制所消耗的能量，不仅不是缺 陷，反而是信任产生过程中最有效的平衡机制。


----------
## 4.POW 共识在新一代公链中的大规模应用  



就现实可执行性角度而言，BitMEX 的研究报告指出，POW 共识机制解决 了区块链分叉的选择、数字货币分发、谁产生区块、什么时间产生区块这四个问题，而改进的 POS 共识机制只是解决了区块链分叉的选择问题，其他三个问题 都是开放的，需要更好的解决路径。

包括 Bytom、Aeternity、Aelf、Zilliqa 在内的新一代公链都包含了 POW 共识机制，第二代公链以太坊第三阶段的 Metropolis 也仍是 POS 和 POW 的 混合体。

<img src="https://www.github.com/jixiyu/images3/raw/master/小书匠/1541335836918.png" width=600 height=800/>  
 <br> </br>
上表所列的公链共识机制选择告诉我们，尽管许多公链有自己独特的设计哲 学，但出于安全性考虑，它们依然绕不开 POW 共识机制的保护。对于开放的、 自治度高的公链环境，POW 共识机制有更好的适用性;而 POS 共识过程的管 理成本很高，在算法更改、分叉选择等重大决策过程中，POS 共识机制才有其 使用价值，但这已经是一种相对中心化的决策机制。  


----------
## 2.

----------
## 2. 

----------
